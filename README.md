# üöÄ Script C√†i ƒê·∫∑t N8N Multi-Mode Enhanced Version 4.0

![N8N](https://img.shields.io/badge/N8N-Automation-blue) ![Docker](https://img.shields.io/badge/Docker-Containerized-blue) ![SSL](https://img.shields.io/badge/SSL-Auto-green) ![Multi-Domain](https://img.shields.io/badge/Multi--Domain-Support-orange) ![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Database-blue) ![API](https://img.shields.io/badge/News%20API-FastAPI-red) ![Telegram](https://img.shields.io/badge/Telegram-Bot-blue) ![Google Drive](https://img.shields.io/badge/Google%20Drive-Backup-green) ![Cloudflare](https://img.shields.io/badge/Cloudflare-Tunnel-purple) ![Auto-Fix](https://img.shields.io/badge/Auto--Fix-Enabled-green)

**üé¨ H√ÉY ƒêƒÇNG K√ù K√äNH YOUTUBE ƒê·ªÇ ·ª¶NG H·ªò M√åNH NH√â! üîî**
üëâ [ƒêƒÇNG K√ù NGAY T·∫†I ƒê√ÇY](https://www.youtube.com/@kalvinthiensocial?sub_confirmation=1) ƒë·ªÉ nh·∫≠n nh·ªØng video h∆∞·ªõng d·∫´n m·ªõi nh·∫•t v·ªÅ N8N, Automation v√† nhi·ªÅu c√¥ng ngh·ªá th√∫ v·ªã kh√°c! 

Script t·ª± ƒë·ªông c√†i ƒë·∫∑t N8N v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng m·ªü r·ªông v√† qu·∫£n l√Ω t·ª´ xa, bao g·ªìm:

## ‚ú® T√≠nh NƒÉng M·ªõi Version 4.0

### üåê Multi-Mode Installation Support
- **Localhost Mode** - Kh√¥ng c·∫ßn domain, truy c·∫≠p qua IP
- **Domain Mode** - C·∫ßn domain v√† DNS v·ªõi SSL t·ª± ƒë·ªông
- **Cloudflare Tunnel Mode** - Kh√¥ng c·∫ßn public IP, ho√†n to√†n b·∫£o m·∫≠t
- **Smart Mode Detection** - T·ª± ƒë·ªông ch·ªçn mode ph√π h·ª£p nh·∫•t

### üîß Auto-Fix Integration System
- **No more 503 errors!** - T·ª± ƒë·ªông fix t·∫•t c·∫£ l·ªói ph·ªï bi·∫øn
- **Permission Auto-Fix** - T·ª± ƒë·ªông s·ª≠a quy·ªÅn th∆∞ m·ª•c (1000:1000)
- **Docker Network Recovery** - T·ª± ƒë·ªông recreate networks b·ªã l·ªói
- **Service Health Recovery** - T·ª± ƒë·ªông restart services kh√¥ng ·ªïn ƒë·ªãnh
- **PostgreSQL Connection Fix** - T·ª± ƒë·ªông fix database connection issues
- **SSL Certificate Recovery** - T·ª± ƒë·ªông fix SSL problems

### ‚òÅÔ∏è Cloudflare Tunnel Support
- **No Public IP Required** - Ho·∫°t ƒë·ªông ngay c·∫£ khi kh√¥ng c√≥ public IP
- **Automatic SSL** - SSL certificates t·ª± ƒë·ªông t·ª´ Cloudflare
- **DDoS Protection** - B·∫£o v·ªá kh·ªèi DDoS attacks
- **Zero Trust Security** - B·∫£o m·∫≠t cao c·∫•p
- **Easy Setup** - Ch·ªâ c·∫ßn tunnel token t·ª´ Cloudflare dashboard

### üîå Custom Port Configuration
- **Dynamic Port Assignment** - T·ª± ƒë·ªông t√¨m port kh·∫£ d·ª•ng
- **Multi-Instance Ports** - M·ªói N8N instance c√≥ port ri√™ng
- **Port Conflict Resolution** - T·ª± ƒë·ªông tr√°nh xung ƒë·ªôt port
- **Custom Base Ports** - C√≥ th·ªÉ thay ƒë·ªïi base port m·∫∑c ƒë·ªãnh

### üìä Enhanced Health Monitoring & Auto-Recovery
- **Real-time Health Checks** - Ki·ªÉm tra s·ª©c kh·ªèe h·ªá th·ªëng li√™n t·ª•c
- **Auto-Recovery System** - T·ª± ƒë·ªông kh√¥i ph·ª•c khi c√≥ l·ªói
- **Performance Metrics** - Theo d√µi hi·ªáu su·∫•t realtime
- **Telegram Alerts** - Th√¥ng b√°o l·ªói qua Telegram
- **Retry Mechanism** - T·ª± ƒë·ªông th·ª≠ l·∫°i khi th·∫•t b·∫°i

### üîí Enhanced Dashboard Security
- **Basic Authentication** - B·∫£o v·ªá dashboard v·ªõi username/password
- **Secure Credentials** - L∆∞u tr·ªØ th√¥ng tin ƒëƒÉng nh·∫≠p an to√†n
- **IP Filtering** - Ch·ªâ cho ph√©p IP ƒë∆∞·ª£c ·ªßy quy·ªÅn
- **Session Management** - Qu·∫£n l√Ω phi√™n ƒëƒÉng nh·∫≠p

### ü§ñ Telegram Bot Management (Enhanced)
- **Qu·∫£n l√Ω t·ª´ xa ho√†n to√†n** qua Telegram
- **Real-time monitoring** v√† alerts
- **Quick actions**: restart, backup, logs, health check
- **Performance metrics** realtime
- **Security**: Ch·ªâ Chat ID ƒë∆∞·ª£c ·ªßy quy·ªÅn
- **Auto-Fix Commands** - L·ªánh fix l·ªói t·ª´ Telegram

### ‚òÅÔ∏è Google Drive Auto Backup (Enhanced)
- **T·ª± ƒë·ªông upload** backup l√™n Google Drive
- **Folder structure** theo nƒÉm/th√°ng/domain
- **Easy restore** t·ª´ Google Drive
- **OAuth2 authentication** b·∫£o m·∫≠t
- **Cross-platform** access
- **Auto-Fix Integration** - T·ª± ƒë·ªông fix backup issues

### üìä Web Dashboard (Enhanced)
- **Browser-based** management interface
- **Real-time charts** v√† metrics
- **Mobile responsive** design
- **Quick actions** v√† troubleshooting
- **Multi-user** support ready
- **Auto-Fix Dashboard** - Giao di·ªán qu·∫£n l√Ω auto-fix

### üîí Enhanced Security (Version 4.0)
- **Basic Authentication** cho N8N instances
- **IP filtering** v√† whitelist
- **Fail2ban** protection
- **SSL security headers**
- **Rate limiting** advanced
- **Cloudflare Zero Trust** integration

### üåê Multi-Domain Support (Enhanced)
- **Nhi·ªÅu N8N instances** tr√™n c√πng m·ªôt server
- **Chia s·∫ª t√†i nguy√™n** hi·ªáu qu·∫£ (News API, PostgreSQL)
- **Qu·∫£n l√Ω t·∫≠p trung** backup v√† monitoring
- **SSL t·ª± ƒë·ªông** cho t·∫•t c·∫£ domains
- **Auto-Fix Multi-Domain** - T·ª± ƒë·ªông fix t·∫•t c·∫£ instances

### üêò PostgreSQL Database Support (Enhanced)
- **Hi·ªáu su·∫•t cao** h∆°n SQLite
- **Concurrent connections** t·ªët h∆°n
- **Backup v√† restore** d·ªÖ d√†ng
- **Chia s·∫ª database** gi·ªØa c√°c instances
- **Ho√†n to√†n mi·ªÖn ph√≠**
- **Auto-Fix Database** - T·ª± ƒë·ªông fix connection issues

## üë®‚Äçüíª Th√¥ng Tin T√°c Gi·∫£

**üåü Nguy·ªÖn Ng·ªçc Thi·ªán üåü**
- üì∫ **YouTube**: [Kalvin Thien Social](https://www.youtube.com/@kalvinthiensocial?sub_confirmation=1) - **üî• H√ÉY ƒêƒÇNG K√ù ƒê·ªÇ ·ª¶NG H·ªò! üî•**
- üìò **Facebook**: [@Ban.Thien.Handsome](https://www.facebook.com/Ban.Thien.Handsome/)
- üì± **Zalo/Phone**: 08.8888.4749
- üé¨ **N8N Playlist**: [Danh s√°ch video N8N](https://www.youtube.com/@kalvinthiensocial/playlists)
- üöÄ **Ng√†y c·∫≠p nh·∫≠t**: 01/07/2025  
- üÜï **Phi√™n b·∫£n**: 4.0 Enhanced - Multi-Mode + Auto-Fix + Cloudflare Tunnel + Health Monitoring + Custom Ports

> üí° **ƒê·ª´ng qu√™n nh·∫•n SUBSCRIBE v√† üîî ƒë·ªÉ kh√¥ng b·ªè l·ª° nh·ªØng video h·ªØu √≠ch m·ªõi nh·∫•t!**
> 
> üéØ K√™nh c·ªßa m√¨nh chia s·∫ª ki·∫øn th·ª©c v·ªÅ:
> - ü§ñ N8N Automation workflows
> - üê≥ Docker & DevOps
> - üíª Server management  
> - üöÄ Latest tech tutorials
> - üì± Social media automation

## üñ•Ô∏è H·ªó Tr·ª£ M√¥i Tr∆∞·ªùng

‚úÖ **Ubuntu VPS/Server** (Recommend)  
‚úÖ **Ubuntu on Windows WSL**  
‚úÖ **Ubuntu Docker Environment**  
‚úÖ **T·ª± ƒë·ªông detect** v√† x·ª≠ l√Ω m√¥i tr∆∞·ªùng  
‚úÖ **Cloudflare Tunnel** - Kh√¥ng c·∫ßn public IP

## üìã Y√™u C·∫ßu H·ªá Th·ªëng

### C∆° B·∫£n
- **OS**: Ubuntu 20.04+ (VPS ho·∫∑c WSL)
- **RAM**: T·ªëi thi·ªÉu 2GB (khuy·∫øn ngh·ªã 4GB+ cho multi-domain)
- **Disk**: 20GB+ free space
- **Network**: Domains ƒë√£ tr·ªè v·ªÅ server (cho Domain Mode)
- **Permission**: Root access

### Enhanced Features (Version 4.0)
- **RAM**: Khuy·∫øn ngh·ªã 4GB+ (m·ªói N8N instance ~512MB)
- **CPU**: 2+ cores cho hi·ªáu su·∫•t t·ªët
- **Disk**: 30GB+ cho nhi·ªÅu instances + backups
- **Google Account**: Cho Google Drive backup (optional)
- **Telegram Bot**: Cho remote management (optional)
- **Cloudflare Account**: Cho Cloudflare Tunnel (optional)

## üöÄ C√†i ƒê·∫∑t Nhanh

### 1Ô∏è‚É£ C√†i ƒê·∫∑t Localhost Mode (Kh√¥ng c·∫ßn domain)

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -l
```

### 2Ô∏è‚É£ C√†i ƒê·∫∑t Cloudflare Tunnel Mode (Kh√¥ng c·∫ßn public IP)

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -f
```

### 3Ô∏è‚É£ C√†i ƒê·∫∑t Multi-Domain + PostgreSQL

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -m -p
```

### 4Ô∏è‚É£ C√†i ƒê·∫∑t Full Features v·ªõi Auto-Fix

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -m -p -g -t
```

### 5Ô∏è‚É£ Options N√¢ng Cao Version 4.0

```bash
# Localhost mode v·ªõi auto-fix
sudo ./auto_cai_dat_n8n.sh -l

# Cloudflare Tunnel mode
sudo ./auto_cai_dat_n8n.sh -f

# Multi-domain v·ªõi PostgreSQL v√† auto-fix
sudo ./auto_cai_dat_n8n.sh -m -p

# Full features v·ªõi t·∫•t c·∫£ t√≠nh nƒÉng
sudo ./auto_cai_dat_n8n.sh -m -p -g -t

# Clean install v·ªõi full features
sudo ./auto_cai_dat_n8n.sh -c -m -p -g -t

# T·∫Øt auto-fix (kh√¥ng khuy·∫øn ngh·ªã)
sudo ./auto_cai_dat_n8n.sh --no-auto-fix

# Xem tr·ª£ gi√∫p
./auto_cai_dat_n8n.sh -h
```

## üîß Qu√° Tr√¨nh C√†i ƒê·∫∑t Version 4.0

Script s·∫Ω h∆∞·ªõng d·∫´n b·∫°n qua c√°c b∆∞·ªõc:

### Installation Modes (M·ªõi)
1. **Localhost Mode** - Kh√¥ng c·∫ßn domain, truy c·∫≠p qua IP
2. **Domain Mode** - C·∫ßn domain v√† DNS v·ªõi SSL t·ª± ƒë·ªông
3. **Cloudflare Tunnel Mode** - Kh√¥ng c·∫ßn public IP, ho√†n to√†n b·∫£o m·∫≠t

### Setup Process (Enhanced)
1. **Ch·ªçn Installation Mode** - Localhost/Domain/Cloudflare
2. **Setup Swap** t·ª± ƒë·ªông (tƒÉng c∆∞·ªùng cho multi-domain)
3. **Nh·∫≠p domains** (single ho·∫∑c multiple)
4. **Custom Port Configuration** - T·ª± ƒë·ªông ph√¢n b·ªï ports
5. **Dashboard Security** - Basic Auth setup
6. **C·∫•u h√¨nh PostgreSQL** (n·∫øu ƒë∆∞·ª£c ch·ªçn)
7. **C·∫•u h√¨nh News API** (t√πy ch·ªçn)
8. **C·∫•u h√¨nh Telegram** (t√πy ch·ªçn)
9. **C·∫•u h√¨nh Google Drive** (n·∫øu ƒë∆∞·ª£c ch·ªçn)
10. **C·∫•u h√¨nh Cloudflare Tunnel** (n·∫øu ƒë∆∞·ª£c ch·ªçn)
11. **Ki·ªÉm tra DNS** cho t·∫•t c·∫£ domains (Domain Mode)
12. **C√†i ƒë·∫∑t Docker** & dependencies
13. **Build & start** t·∫•t c·∫£ containers v·ªõi auto-fix
14. **Setup SSL** cho t·∫•t c·∫£ domains
15. **Thi·∫øt l·∫≠p services** (Dashboard, Telegram Bot, Health Monitor)
16. **Auto-Fix Integration** - Ki·ªÉm tra v√† fix l·ªói t·ª± ƒë·ªông

## üîß Auto-Fix System (Version 4.0)

### üõ†Ô∏è T·ª± ƒê·ªông Fix C√°c L·ªói Ph·ªï Bi·∫øn
- **Permission Issues** - T·ª± ƒë·ªông fix quy·ªÅn th∆∞ m·ª•c (1000:1000)
- **Docker Network Problems** - T·ª± ƒë·ªông recreate networks
- **Container Health Issues** - T·ª± ƒë·ªông restart containers kh√¥ng ·ªïn ƒë·ªãnh
- **PostgreSQL Connection** - T·ª± ƒë·ªông fix database connection
- **SSL Certificate Problems** - T·ª± ƒë·ªông fix SSL issues
- **Port Conflicts** - T·ª± ƒë·ªông t√¨m port kh·∫£ d·ª•ng

### üîÑ Auto-Recovery Features
- **Health Monitoring** - Ki·ªÉm tra s·ª©c kh·ªèe h·ªá th·ªëng li√™n t·ª•c
- **Retry Mechanism** - T·ª± ƒë·ªông th·ª≠ l·∫°i khi th·∫•t b·∫°i
- **Graceful Degradation** - H·ªá th·ªëng v·∫´n ho·∫°t ƒë·ªông khi c√≥ l·ªói
- **Telegram Alerts** - Th√¥ng b√°o l·ªói v√† fix status

### üìä Auto-Fix Commands
```bash
# T·ª± ƒë·ªông fix t·∫•t c·∫£ l·ªói
/home/n8n/auto-fix.sh

# Fix permissions
/home/n8n/auto-fix.sh permissions

# Fix Docker networks
/home/n8n/auto-fix.sh networks

# Fix PostgreSQL
/home/n8n/auto-fix.sh database

# Fix SSL certificates
/home/n8n/auto-fix.sh ssl
```

## ‚òÅÔ∏è Cloudflare Tunnel Mode (Version 4.0)

### üåê T√≠nh NƒÉng Cloudflare Tunnel
- **No Public IP Required** - Ho·∫°t ƒë·ªông ngay c·∫£ khi kh√¥ng c√≥ public IP
- **Automatic SSL** - SSL certificates t·ª± ƒë·ªông t·ª´ Cloudflare
- **DDoS Protection** - B·∫£o v·ªá kh·ªèi DDoS attacks
- **Zero Trust Security** - B·∫£o m·∫≠t cao c·∫•p
- **Easy Setup** - Ch·ªâ c·∫ßn tunnel token t·ª´ Cloudflare dashboard

### üîß Thi·∫øt L·∫≠p Cloudflare Tunnel
1. Truy c·∫≠p [Cloudflare Zero Trust](https://one.dash.cloudflare.com/)
2. V√†o Zero Trust ‚Üí Access ‚Üí Tunnels
3. Create a tunnel ‚Üí Cloudflared
4. ƒê·∫∑t t√™n tunnel (vd: n8n-tunnel)
5. Copy tunnel token
6. Nh·∫≠p token v√†o script

### üìÅ C·∫•u Tr√∫c Cloudflare
```
/home/n8n/cloudflare/
‚îú‚îÄ‚îÄ config.yml              # Tunnel configuration
‚îú‚îÄ‚îÄ credentials.json        # Cloudflare credentials
‚îî‚îÄ‚îÄ tunnel.log             # Tunnel logs
```

## üîå Custom Port Configuration (Version 4.0)

### üåê Dynamic Port Assignment
- **Auto Port Detection** - T·ª± ƒë·ªông t√¨m port kh·∫£ d·ª•ng
- **Port Conflict Resolution** - Tr√°nh xung ƒë·ªôt port
- **Custom Base Ports** - C√≥ th·ªÉ thay ƒë·ªïi base port m·∫∑c ƒë·ªãnh
- **Multi-Instance Ports** - M·ªói N8N instance c√≥ port ri√™ng

### üìä Port Management
```bash
# Default ports
N8N Base Port: 5678
API Base Port: 8000
Dashboard Port: 8080

# Multi-domain ports
Instance 1: 5678
Instance 2: 5800
Instance 3: 5801
...
```

## üìä Enhanced Health Monitoring (Version 4.0)

### üè• Health Check System
- **Real-time Monitoring** - Ki·ªÉm tra s·ª©c kh·ªèe h·ªá th·ªëng li√™n t·ª•c
- **Auto-Recovery** - T·ª± ƒë·ªông kh√¥i ph·ª•c khi c√≥ l·ªói
- **Performance Metrics** - Theo d√µi hi·ªáu su·∫•t realtime
- **Telegram Alerts** - Th√¥ng b√°o l·ªói qua Telegram

### üîÑ Health Check Features
```bash
# Health check endpoints
N8N: /healthz
News API: /health
PostgreSQL: pg_isready
Caddy: Built-in health checks

# Health check interval: 30s
# Retry attempts: 3
# Auto-recovery: Enabled
```

## ü§ñ Telegram Bot Management (Enhanced Version 4.0)

### üîß L·ªánh Bot C∆° B·∫£n
```
/start          - Kh·ªüi ƒë·ªông bot
/status         - Tr·∫°ng th√°i t·∫•t c·∫£ instances
/health         - Health check chi ti·∫øt
/performance    - Performance metrics
/help           - Danh s√°ch l·ªánh
```

### üõ†Ô∏è Qu·∫£n L√Ω Services (Enhanced)
```
/restart all              - Restart t·∫•t c·∫£ services
/restart n8n              - Restart N8N container
/restart caddy            - Restart Caddy proxy
/restart postgres         - Restart PostgreSQL
/auto-fix                 - Ch·∫°y auto-fix system
/auto-fix permissions     - Fix permissions
/auto-fix networks        - Fix Docker networks
/auto-fix database        - Fix PostgreSQL
/auto-fix ssl             - Fix SSL certificates
```

### üìã Logs & Monitoring (Enhanced)
```
/logs all                 - Logs t·∫•t c·∫£ services
/logs n8n 50              - 50 d√≤ng logs cu·ªëi c·ªßa N8N
/backup                   - Ch·∫°y backup manual
/troubleshoot             - Ch·∫°y diagnostic
/health-monitor           - Health monitor status
```

### üìä V√≠ D·ª• Output (Enhanced)
```
üöÄ N8N System Status v4.0

üìä System Info:
‚Ä¢ Uptime: up 2 days, 14 hours, 32 minutes
‚Ä¢ Memory: 2.1G/4.0G
‚Ä¢ Disk Usage: 45%
‚Ä¢ Auto-Fix: ‚úÖ Enabled
‚Ä¢ Health Monitor: ‚úÖ Active

üåê Installation Mode: Cloudflare Tunnel
üåê Domains (3):
‚Ä¢ Instance 1: n8n1.example.com (Port: 5678)
‚Ä¢ Instance 2: n8n2.example.com (Port: 5800)
‚Ä¢ Instance 3: n8n3.example.com (Port: 5801)

üê≥ Containers (6):
‚úÖ n8n-container-1: running (healthy)
‚úÖ n8n-container-2: running (healthy)
‚úÖ caddy-proxy: running (healthy)
‚úÖ postgres-n8n: running (healthy)
‚úÖ cloudflared: running (healthy)
‚úÖ news-api-container: running (healthy)

üîß Auto-Fix Status:
‚Ä¢ Last Check: 2 minutes ago
‚Ä¢ Issues Fixed: 0
‚Ä¢ System Health: ‚úÖ Excellent
```

## ‚òÅÔ∏è Google Drive Backup System (Enhanced Version 4.0)

### üîß Thi·∫øt L·∫≠p Google Drive API
1. Truy c·∫≠p [Google Cloud Console](https://console.developers.google.com/)
2. T·∫°o project m·ªõi ho·∫∑c ch·ªçn project c√≥ s·∫µn
3. Enable Google Drive API
4. T·∫°o Service Account credentials
5. Download JSON credentials file
6. Share Google Drive folder v·ªõi service account

### üìÅ C·∫•u Tr√∫c Backup (Enhanced)
```
N8N-Backups/
‚îú‚îÄ‚îÄ 2025/
‚îÇ   ‚îú‚îÄ‚îÄ 06-June/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain1.com/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ n8n_backup_20250628_140000.zip
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ n8n_backup_20250627_020000.zip
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain2.com/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ All-Domains/
‚îÇ   ‚îî‚îÄ‚îÄ 07-July/
‚îî‚îÄ‚îÄ 2024/
```

### üîÑ Auto Backup Features (Enhanced)
- **Daily upload** l√™n Google Drive
- **Organized by** year/month/domain
- **Automatic cleanup** old backups
- **Telegram notifications** v·ªõi status
- **Fallback local** n·∫øu upload th·∫•t b·∫°i
- **Auto-Fix Integration** - T·ª± ƒë·ªông fix backup issues

## üìä Web Dashboard (Enhanced Version 4.0)

### üåê Truy C·∫≠p Dashboard
```
http://YOUR_SERVER_IP:8080
```

### üìà T√≠nh NƒÉng Dashboard (Enhanced)
- **Real-time monitoring** t·∫•t c·∫£ instances
- **System metrics** (CPU, Memory, Disk, Network)
- **Container status** v·ªõi health checks
- **SSL certificate** monitoring
- **Backup status** v√† history
- **Quick actions** (restart, backup, logs)
- **Mobile responsive** design
- **Auto-refresh** every 30 seconds
- **Auto-Fix Dashboard** - Giao di·ªán qu·∫£n l√Ω auto-fix
- **Health Monitor Status** - Tr·∫°ng th√°i health monitoring

### üîß Quick Actions (Enhanced)
- üîÑ **Refresh Data** - C·∫≠p nh·∫≠t realtime
- üîÑ **Restart All** - Restart t·∫•t c·∫£ services
- üíæ **Manual Backup** - Ch·∫°y backup manual
- üìã **View Logs** - Xem logs trong tab m·ªõi
- ‚¨ÜÔ∏è **Update System** - Update h·ªá th·ªëng
- üîß **Troubleshoot** - Ch·∫°y diagnostic script
- üõ†Ô∏è **Auto-Fix** - Ch·∫°y auto-fix system
- üè• **Health Check** - Ch·∫°y health check manual

## üì∞ News Content API (Enhanced Version 4.0)

### üîë Authentication
T·∫•t c·∫£ API calls y√™u c·∫ßu Bearer Token:
```bash
Authorization: Bearer YOUR_TOKEN_HERE
```

### üìñ API Documentation
Sau khi c√†i ƒë·∫∑t, truy c·∫≠p:
- **Homepage**: `https://api.yourdomain.com/`
- **Swagger UI**: `https://api.yourdomain.com/docs`
- **ReDoc**: `https://api.yourdomain.com/redoc`

### üíª V√≠ D·ª• cURL
```bash
# L·∫•y n·ªôi dung b√†i vi·∫øt
curl -X POST "https://api.yourdomain.com/extract-article" \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -d '{
       "url": "https://dantri.com.vn/the-gioi.htm",
       "language": "vi",
       "extract_images": true,
       "summarize": true
     }'
```

## üíæ Enhanced Backup & Restore System (Version 4.0)

### üîÑ Multi-Domain Backup Features (Enhanced)
- **ZIP compression** t·ªëi ∆∞u dung l∆∞·ª£ng
- **Multi-domain backup** t·∫•t c·∫£ instances c√πng l√∫c
- **PostgreSQL databases** backup ri√™ng t·ª´ng instance
- **SSL certificates** backup v√† restore
- **Configuration files** backup
- **Metadata** chi ti·∫øt cho m·ªói backup
- **Auto-Fix Integration** - T·ª± ƒë·ªông fix backup issues

### üì± Telegram Integration (Enhanced)
- **Detailed reports** v·ªÅ t·∫•t c·∫£ instances
- **File upload** n·∫øu <50MB
- **Status notifications** success/failure
- **Fallback**: Gi·ªØ backup local n·∫øu Telegram th·∫•t b·∫°i
- **Auto-Fix Notifications** - Th√¥ng b√°o auto-fix status

### ‚òÅÔ∏è Google Drive Integration (Enhanced)
- **Auto-upload** sau m·ªói backup
- **Organized folders** theo domain v√† ng√†y
- **Easy restore** t·ª´ Google Drive
- **Cross-platform** access
- **Auto-Fix Integration** - T·ª± ƒë·ªông fix upload issues

### üîÑ Restore System (Enhanced)
```bash
# Restore t·ª´ backup file
/home/n8n/restore-from-backup.sh /path/to/backup.zip

# Restore domain c·ª• th·ªÉ
/home/n8n/restore-from-backup.sh /path/to/backup.zip domain.com

# Restore s·∫Ω:
# 1. Stop t·∫•t c·∫£ services
# 2. Restore configuration files
# 3. Restore SSL certificates
# 4. Restore PostgreSQL databases
# 5. Restore N8N instances data
# 6. Import workflows v√† credentials
# 7. Start t·∫•t c·∫£ services
# 8. Run auto-fix ƒë·ªÉ ƒë·∫£m b·∫£o stability
```

## üîí Enhanced Security Features (Version 4.0)

### üîê Basic Authentication (Enhanced)
- **Auto-generated** username/password cho N8N
- **Secure storage** credentials
- **Easy rotation** passwords
- **Dashboard Security** - Basic Auth cho dashboard

### üõ°Ô∏è IP Filtering (Enhanced)
- **Whitelist** allowed IP addresses
- **CIDR block** support
- **Easy configuration** via file
- **Cloudflare Integration** - IP filtering v·ªõi Cloudflare

### üö´ Fail2ban Protection (Enhanced)
- **Auto-ban** malicious IPs
- **Custom rules** cho N8N
- **Configurable** ban times
- **Cloudflare Integration** - Fail2ban v·ªõi Cloudflare

### üîí SSL Security Headers (Enhanced)
- **HSTS** enforcement
- **XSS protection**
- **Content Security Policy**
- **Frame protection**
- **Cloudflare Zero Trust** integration

## üõ†Ô∏è Qu·∫£n L√Ω H·ªá Th·ªëng (Version 4.0)

### üîß L·ªánh C∆° B·∫£n (Enhanced)
```bash
# Xem tr·∫°ng th√°i t·∫•t c·∫£ containers
cd /home/n8n && docker-compose ps

# Xem logs realtime t·∫•t c·∫£ services
cd /home/n8n && docker-compose logs -f

# Restart to√†n b·ªô h·ªá th·ªëng
cd /home/n8n && docker-compose restart

# Web Dashboard
http://YOUR_SERVER_IP:8080

# Auto-Fix System
/home/n8n/auto-fix.sh

# Health Monitor
systemctl status n8n-health-monitor

# Troubleshoot script
/home/n8n/troubleshoot.sh
```

### üìä Management Tools (Enhanced)
```bash
# Enhanced backup
/home/n8n/backup-workflows-enhanced.sh

# Restore system
/home/n8n/restore-from-backup.sh

# Manual backup test
/home/n8n/backup-manual.sh

# Auto-Fix System
/home/n8n/auto-fix.sh

# Health Monitor
/home/n8n/health_checks/health_monitor.sh
```

## üìÇ C·∫•u Tr√∫c Th∆∞ M·ª•c Enhanced (Version 4.0)

```
/home/n8n/
‚îú‚îÄ‚îÄ docker-compose.yml              # Main config v·ªõi multi-domain
‚îú‚îÄ‚îÄ Dockerfile                      # N8N custom image
‚îú‚îÄ‚îÄ Caddyfile                       # Reverse proxy cho t·∫•t c·∫£ domains
‚îú‚îÄ‚îÄ init-multi-db.sh                # PostgreSQL init script
‚îú‚îÄ‚îÄ backup-workflows-enhanced.sh    # Enhanced backup script
‚îú‚îÄ‚îÄ restore-from-backup.sh          # Enhanced restore script
‚îú‚îÄ‚îÄ troubleshoot.sh                 # Multi-domain diagnostic script
‚îú‚îÄ‚îÄ auto-fix.sh                     # Auto-Fix system script
‚îú‚îÄ‚îÄ telegram_config.txt             # Telegram settings
‚îú‚îÄ‚îÄ dashboard/                      # Web Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ index.html                 # Dashboard UI
‚îÇ   ‚îú‚îÄ‚îÄ api_server.py              # Dashboard API server
‚îÇ   ‚îî‚îÄ‚îÄ assets/                    # Static assets
‚îú‚îÄ‚îÄ telegram_bot/                   # Telegram Bot Management
‚îÇ   ‚îú‚îÄ‚îÄ bot.py                     # Main bot script
‚îÇ   ‚îî‚îÄ‚îÄ start_bot.sh               # Bot startup script
‚îú‚îÄ‚îÄ google_drive/                   # Google Drive Integration
‚îÇ   ‚îú‚îÄ‚îÄ gdrive_backup.py           # Google Drive backup script
‚îÇ   ‚îú‚îÄ‚îÄ credentials.json           # Service account credentials
‚îÇ   ‚îî‚îÄ‚îÄ cleanup_old_backups.py     # Cleanup script
‚îú‚îÄ‚îÄ cloudflare/                     # Cloudflare Tunnel
‚îÇ   ‚îú‚îÄ‚îÄ config.yml                 # Tunnel configuration
‚îÇ   ‚îú‚îÄ‚îÄ credentials.json           # Cloudflare credentials
‚îÇ   ‚îî‚îÄ‚îÄ tunnel.log                 # Tunnel logs
‚îú‚îÄ‚îÄ health_checks/                  # Health Monitoring
‚îÇ   ‚îú‚îÄ‚îÄ health_monitor.sh          # Health monitor script
‚îÇ   ‚îú‚îÄ‚îÄ health_check.sh            # Health check script
‚îÇ   ‚îî‚îÄ‚îÄ auto_recovery.sh           # Auto recovery script
‚îú‚îÄ‚îÄ security/                       # Security configurations
‚îÇ   ‚îú‚îÄ‚îÄ setup_security.sh          # Security setup script
‚îÇ   ‚îú‚îÄ‚îÄ auth_credentials.txt        # Basic auth credentials
‚îÇ   ‚îú‚îÄ‚îÄ allowed_ips.txt            # IP whitelist
‚îÇ   ‚îî‚îÄ‚îÄ ssl_headers.conf           # SSL security headers
‚îú‚îÄ‚îÄ management/                     # Management tools
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.sh               # CLI dashboard
‚îÇ   ‚îú‚îÄ‚îÄ menu.sh                    # Management menu
‚îÇ   ‚îî‚îÄ‚îÄ export-migration.sh        # Migration tools
‚îú‚îÄ‚îÄ files/                          # N8N data
‚îÇ   ‚îú‚îÄ‚îÄ backup_full/               # Enhanced backup storage
‚îÇ   ‚îú‚îÄ‚îÄ n8n_instance_1/           # Instance 1 data
‚îÇ   ‚îú‚îÄ‚îÄ n8n_instance_2/           # Instance 2 data
‚îÇ   ‚îî‚îÄ‚îÄ n8n_instance_n/           # Instance N data
‚îú‚îÄ‚îÄ postgres_data/                  # PostgreSQL data (if enabled)
‚îú‚îÄ‚îÄ logs/                          # System logs
‚îî‚îÄ‚îÄ news_api/                       # News API (shared)
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ requirements.txt
    ‚îî‚îÄ‚îÄ main.py
```

## ‚ö° Performance Tips (Version 4.0)

### üöÄ Multi-Mode Optimization
1. **Localhost Mode**: T·ªëi ∆∞u cho development v√† testing
2. **Domain Mode**: T·ªëi ∆∞u cho production v·ªõi SSL
3. **Cloudflare Mode**: T·ªëi ∆∞u cho b·∫£o m·∫≠t cao v√† kh√¥ng c√≥ public IP
4. **Memory**: Script t·ª± ƒë·ªông tƒÉng swap cho multi-domain
5. **CPU**: M·ªói N8N instance s·ª≠ d·ª•ng optimized workers
6. **Database**: PostgreSQL shared connection pooling
7. **Disk**: Auto cleanup old backups v√† logs
8. **Network**: Caddy auto-compression cho t·∫•t c·∫£ domains

### üìä Monitoring Multi-Mode (Enhanced)
```bash
# Resource usage t·∫•t c·∫£ containers
docker stats --no-stream

# Real-time dashboard
http://YOUR_SERVER_IP:8080

# Telegram monitoring
/status trong Telegram Bot

# Performance metrics
/performance trong Telegram Bot

# Health monitor
systemctl status n8n-health-monitor

# Auto-fix status
/home/n8n/auto-fix.sh status
```

## üêõ Troubleshooting (Version 4.0)

### ‚ùå L·ªói Th∆∞·ªùng G·∫∑p Enhanced

**1. Auto-Fix System kh√¥ng ho·∫°t ƒë·ªông**
```bash
# Ki·ªÉm tra auto-fix service
systemctl status n8n-auto-fix

# Ch·∫°y auto-fix manual
/home/n8n/auto-fix.sh

# Xem auto-fix logs
tail -f /var/log/n8n-auto-fix.log
```

**2. Cloudflare Tunnel kh√¥ng k·∫øt n·ªëi**
```bash
# Ki·ªÉm tra tunnel status
systemctl status cloudflared

# Xem tunnel logs
journalctl -u cloudflared -f

# Test tunnel connection
cloudflared tunnel info
```

**3. Health Monitor kh√¥ng ho·∫°t ƒë·ªông**
```bash
# Ki·ªÉm tra health monitor
systemctl status n8n-health-monitor

# Xem health monitor logs
journalctl -u n8n-health-monitor -f

# Restart health monitor
systemctl restart n8n-health-monitor
```

**4. Custom Ports kh√¥ng ho·∫°t ƒë·ªông**
```bash
# Ki·ªÉm tra port usage
netstat -tulpn | grep :5678

# Check port conflicts
/home/n8n/auto-fix.sh ports

# Fix port issues
/home/n8n/auto-fix.sh networks
```

**5. Multi-Mode issues**
```bash
# Ki·ªÉm tra installation mode
cat /home/n8n/installation_mode.txt

# Switch mode
/home/n8n/switch-mode.sh localhost
/home/n8n/switch-mode.sh domain
/home/n8n/switch-mode.sh cloudflare
```

## üåü Features Roadmap (Version 4.0)

- [x] **Multi-Mode** support (Localhost/Domain/Cloudflare) ‚úÖ
- [x] **Auto-Fix Integration** system ‚úÖ
- [x] **Health Monitoring** & Auto-Recovery ‚úÖ
- [x] **Custom Port Configuration** ‚úÖ
- [x] **Cloudflare Tunnel** support ‚úÖ
- [x] **Multi-domain** support ‚úÖ
- [x] **PostgreSQL** external database ‚úÖ
- [x] **Telegram Bot** management ‚úÖ
- [x] **Google Drive** backup ‚úÖ
- [x] **Web Dashboard** ‚úÖ
- [x] **Enhanced Security** ‚úÖ
- [ ] **Load balancing** between instances
- [ ] **Kubernetes** deployment
- [ ] **Advanced monitoring** dashboard with metrics
- [ ] **Auto-scaling** based on load
- [ ] **Plugin** marketplace integration
- [ ] **Cross-instance** workflow sharing
- [ ] **Multi-cloud** deployment support

## ü§ù Contributing

1. Fork repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Create Pull Request

## üìÑ License

MIT License - Xem file [LICENSE](LICENSE)

## üí¨ Support

- **Issues**: [GitHub Issues](https://github.com/KalvinThien/install-n8n-ffmpeg/issues)
- **YouTube**: [Kalvin Thien Social](https://www.youtube.com/@kalvinthiensocial)
- **Facebook**: [Ban Thien Handsome](https://www.facebook.com/Ban.Thien.Handsome/)
- **Zalo**: 08.8888.4749

## ‚≠ê Star History

N·∫øu script n√†y h·ªØu √≠ch, h√£y cho m·ªôt ‚≠ê star ƒë·ªÉ ·ªßng h·ªô!

[![Star History Chart](https://api.star-history.com/svg?repos=KalvinThien/install-n8n-ffmpeg&type=Date)](https://star-history.com/#KalvinThien/install-n8n-ffmpeg&Date)

---

**üöÄ Made with ‚ù§Ô∏è by Nguy·ªÖn Ng·ªçc Thi·ªán - 01/07/2025**  
**üÜï Enhanced Version 4.0 - Multi-Mode + Auto-Fix + Cloudflare Tunnel + Health Monitoring + Custom Ports**

## üîß Troubleshooting & Fix Issues (Version 4.0)

### üö® Khi g·∫∑p l·ªói HTTP 502 ho·∫∑c N8N kh√¥ng ho·∫°t ƒë·ªông

N·∫øu g·∫∑p c√°c v·∫•n ƒë·ªÅ sau:
- ‚ùå HTTP ERROR 502 khi truy c·∫≠p domains
- ‚ùå N8N containers li√™n t·ª•c restart
- ‚ùå Permission denied errors
- ‚ùå PostgreSQL connection issues
- ‚ùå SSL certificate problems
- ‚ùå Cloudflare Tunnel connection issues
- ‚ùå Health monitor not working

### üõ†Ô∏è Auto-Fix System To√†n Di·ªán (Version 4.0)

**Script `auto-fix.sh` s·∫Ω t·ª± ƒë·ªông fix t·∫•t c·∫£ v·∫•n ƒë·ªÅ:**

```bash
# 1. Auto-Fix System ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p s·∫µn
# Ch·∫°y auto-fix to√†n di·ªán
sudo /home/n8n/auto-fix.sh

# 2. Fix t·ª´ng ph·∫ßn c·ª• th·ªÉ
sudo /home/n8n/auto-fix.sh permissions    # Fix permissions
sudo /home/n8n/auto-fix.sh networks       # Fix Docker networks
sudo /home/n8n/auto-fix.sh database       # Fix PostgreSQL
sudo /home/n8n/auto-fix.sh ssl            # Fix SSL certificates
sudo /home/n8n/auto-fix.sh ports          # Fix port conflicts
sudo /home/n8n/auto-fix.sh health         # Fix health monitor
```

### üîç Auto-Fix System s·∫Ω fix c√°c v·∫•n ƒë·ªÅ:

1. **‚úÖ Fix Permission Issues (1000:1000)**
   - Ch·ªânh s·ª≠a quy·ªÅn th∆∞ m·ª•c N8N
   - Fix user/group ownership
   - T·∫°o missing directories

2. **üåê Fix Docker Network & Service Names**
   - Recreate Docker networks
   - Fix container name resolution
   - Clean up old networks

3. **üêò Fix PostgreSQL Database Issues**
   - T·∫°o l·∫°i users v√† databases
   - Fix connection issues
   - Test database connectivity

4. **üîí Fix SSL Certificate Problems**
   - Update Caddyfile v·ªõi container names ƒë√∫ng
   - Add health checks
   - Fix reverse proxy configuration

5. **‚òÅÔ∏è Fix Cloudflare Tunnel Issues**
   - Recreate tunnel configuration
   - Fix tunnel credentials
   - Restart tunnel service

6. **üîå Fix Custom Port Issues**
   - Resolve port conflicts
   - Reassign available ports
   - Update configuration files

7. **üè• Fix Health Monitor Issues**
   - Restart health monitor service
   - Fix health check scripts
   - Update monitoring configuration

8. **üöÄ Restart Services in Correct Order**
   - PostgreSQL ‚Üí N8N ‚Üí API ‚Üí Caddy ‚Üí Cloudflare
   - Verify service health
   - Clean up old containers

9. **üìä Health Check All Components**
   - Test container connectivity
   - Verify domain accessibility
   - Check SSL certificates
   - Test Cloudflare tunnel

### üìã Log v√† Monitoring (Enhanced)

Auto-Fix System s·∫Ω t·∫°o log file chi ti·∫øt t·∫°i `/var/log/n8n-auto-fix.log`

```bash
# Xem log auto-fix
tail -f /var/log/n8n-auto-fix.log

# Monitor containers sau khi fix
cd /home/n8n && docker-compose logs -f

# Check status
cd /home/n8n && docker-compose ps

# Health monitor status
systemctl status n8n-health-monitor
```

### üéØ K·∫øt qu·∫£ mong ƒë·ª£i sau khi auto-fix:

‚úÖ T·∫•t c·∫£ domains ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng  
‚úÖ SSL certificates ƒë∆∞·ª£c c·∫•p t·ª± ƒë·ªông  
‚úÖ N8N instances kh·ªüi ƒë·ªông ·ªïn ƒë·ªãnh  
‚úÖ PostgreSQL k·∫øt n·ªëi th√†nh c√¥ng  
‚úÖ Cloudflare Tunnel ho·∫°t ƒë·ªông  
‚úÖ Health Monitor active  
‚úÖ No more HTTP 502 errors  
‚úÖ Auto-Fix System ready  

**‚è∞ L∆∞u √Ω**: C·∫ßn ƒë·ª£i 2-3 ph√∫t sau khi fix ƒë·ªÉ SSL certificates ƒë∆∞·ª£c c·∫•p ho√†n to√†n v√† Cloudflare Tunnel k·∫øt n·ªëi.

### üîÑ Auto-Fix Integration v·ªõi Telegram Bot

```bash
# L·ªánh Telegram Bot cho auto-fix
/auto-fix                 # Ch·∫°y auto-fix to√†n di·ªán
/auto-fix permissions     # Fix permissions
/auto-fix networks        # Fix Docker networks
/auto-fix database        # Fix PostgreSQL
/auto-fix ssl             # Fix SSL certificates
/auto-fix health          # Fix health monitor
/auto-fix status          # Xem auto-fix status
```
