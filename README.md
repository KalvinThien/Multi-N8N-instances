# ğŸš€ Script CÃ i Äáº·t N8N Multi-Mode Enhanced Version 4.0

![N8N](https://img.shields.io/badge/N8N-Automation-blue) ![Docker](https://img.shields.io/badge/Docker-Containerized-blue) ![SSL](https://img.shields.io/badge/SSL-Auto-green) ![Multi-Domain](https://img.shields.io/badge/Multi--Domain-Support-orange) ![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Database-blue) ![API](https://img.shields.io/badge/News%20API-FastAPI-red) ![Telegram](https://img.shields.io/badge/Telegram-Bot-blue) ![Google Drive](https://img.shields.io/badge/Google%20Drive-Backup-green) ![Cloudflare](https://img.shields.io/badge/Cloudflare-Tunnel-purple) ![Auto-Fix](https://img.shields.io/badge/Auto--Fix-Enabled-green)

**ğŸ¬ HÃƒY ÄÄ‚NG KÃ KÃŠNH YOUTUBE Äá»‚ á»¦NG Há»˜ MÃŒNH NHÃ‰! ğŸ””**
ğŸ‘‰ [ÄÄ‚NG KÃ NGAY Táº I ÄÃ‚Y](https://www.youtube.com/@kalvinthiensocial?sub_confirmation=1) Ä‘á»ƒ nháº­n nhá»¯ng video hÆ°á»›ng dáº«n má»›i nháº¥t vá» N8N, Automation vÃ  nhiá»u cÃ´ng nghá»‡ thÃº vá»‹ khÃ¡c! 

Script tá»± Ä‘á»™ng cÃ i Ä‘áº·t N8N vá»›i Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng má»Ÿ rá»™ng vÃ  quáº£n lÃ½ tá»« xa, bao gá»“m:

## âœ¨ TÃ­nh NÄƒng Má»›i Version 4.0

### ğŸŒ Multi-Mode Installation Support
- **Localhost Mode** - KhÃ´ng cáº§n domain, truy cáº­p qua IP
- **Domain Mode** - Cáº§n domain vÃ  DNS vá»›i SSL tá»± Ä‘á»™ng
- **Cloudflare Tunnel Mode** - KhÃ´ng cáº§n public IP, hoÃ n toÃ n báº£o máº­t
- **Smart Mode Detection** - Tá»± Ä‘á»™ng chá»n mode phÃ¹ há»£p nháº¥t

### ğŸ”§ Auto-Fix Integration System
- **No more 503 errors!** - Tá»± Ä‘á»™ng fix táº¥t cáº£ lá»—i phá»• biáº¿n
- **Permission Auto-Fix** - Tá»± Ä‘á»™ng sá»­a quyá»n thÆ° má»¥c (1000:1000)
- **Docker Network Recovery** - Tá»± Ä‘á»™ng recreate networks bá»‹ lá»—i
- **Service Health Recovery** - Tá»± Ä‘á»™ng restart services khÃ´ng á»•n Ä‘á»‹nh
- **PostgreSQL Connection Fix** - Tá»± Ä‘á»™ng fix database connection issues
- **SSL Certificate Recovery** - Tá»± Ä‘á»™ng fix SSL problems

### â˜ï¸ Cloudflare Tunnel Support
- **No Public IP Required** - Hoáº¡t Ä‘á»™ng ngay cáº£ khi khÃ´ng cÃ³ public IP
- **Automatic SSL** - SSL certificates tá»± Ä‘á»™ng tá»« Cloudflare
- **DDoS Protection** - Báº£o vá»‡ khá»i DDoS attacks
- **Zero Trust Security** - Báº£o máº­t cao cáº¥p
- **Easy Setup** - Chá»‰ cáº§n tunnel token tá»« Cloudflare dashboard

### ğŸ”Œ Custom Port Configuration
- **Dynamic Port Assignment** - Tá»± Ä‘á»™ng tÃ¬m port kháº£ dá»¥ng
- **Multi-Instance Ports** - Má»—i N8N instance cÃ³ port riÃªng
- **Port Conflict Resolution** - Tá»± Ä‘á»™ng trÃ¡nh xung Ä‘á»™t port
- **Custom Base Ports** - CÃ³ thá»ƒ thay Ä‘á»•i base port máº·c Ä‘á»‹nh

### ğŸ“Š Enhanced Health Monitoring & Auto-Recovery
- **Real-time Health Checks** - Kiá»ƒm tra sá»©c khá»e há»‡ thá»‘ng liÃªn tá»¥c
- **Auto-Recovery System** - Tá»± Ä‘á»™ng khÃ´i phá»¥c khi cÃ³ lá»—i
- **Performance Metrics** - Theo dÃµi hiá»‡u suáº¥t realtime
- **Telegram Alerts** - ThÃ´ng bÃ¡o lá»—i qua Telegram
- **Retry Mechanism** - Tá»± Ä‘á»™ng thá»­ láº¡i khi tháº¥t báº¡i

### ğŸ”’ Enhanced Dashboard Security
- **Basic Authentication** - Báº£o vá»‡ dashboard vá»›i username/password
- **Secure Credentials** - LÆ°u trá»¯ thÃ´ng tin Ä‘Äƒng nháº­p an toÃ n
- **IP Filtering** - Chá»‰ cho phÃ©p IP Ä‘Æ°á»£c á»§y quyá»n
- **Session Management** - Quáº£n lÃ½ phiÃªn Ä‘Äƒng nháº­p

### ğŸ¤– Telegram Bot Management (Enhanced)
- **Quáº£n lÃ½ tá»« xa hoÃ n toÃ n** qua Telegram
- **Real-time monitoring** vÃ  alerts
- **Quick actions**: restart, backup, logs, health check
- **Performance metrics** realtime
- **Security**: Chá»‰ Chat ID Ä‘Æ°á»£c á»§y quyá»n
- **Auto-Fix Commands** - Lá»‡nh fix lá»—i tá»« Telegram

### â˜ï¸ Google Drive Auto Backup (Enhanced)
- **Tá»± Ä‘á»™ng upload** backup lÃªn Google Drive
- **Folder structure** theo nÄƒm/thÃ¡ng/domain
- **Easy restore** tá»« Google Drive
- **OAuth2 authentication** báº£o máº­t
- **Cross-platform** access
- **Auto-Fix Integration** - Tá»± Ä‘á»™ng fix backup issues

### ğŸ“Š Web Dashboard (Enhanced)
- **Browser-based** management interface
- **Real-time charts** vÃ  metrics
- **Mobile responsive** design
- **Quick actions** vÃ  troubleshooting
- **Multi-user** support ready
- **Auto-Fix Dashboard** - Giao diá»‡n quáº£n lÃ½ auto-fix

### ğŸ”’ Enhanced Security (Version 4.0)
- **Basic Authentication** cho N8N instances
- **IP filtering** vÃ  whitelist
- **Fail2ban** protection
- **SSL security headers**
- **Rate limiting** advanced
- **Cloudflare Zero Trust** integration

### ğŸŒ Multi-Domain Support (Enhanced)
- **Nhiá»u N8N instances** trÃªn cÃ¹ng má»™t server
- **Chia sáº» tÃ i nguyÃªn** hiá»‡u quáº£ (News API, PostgreSQL)
- **Quáº£n lÃ½ táº­p trung** backup vÃ  monitoring
- **SSL tá»± Ä‘á»™ng** cho táº¥t cáº£ domains
- **Auto-Fix Multi-Domain** - Tá»± Ä‘á»™ng fix táº¥t cáº£ instances

### ğŸ˜ PostgreSQL Database Support (Enhanced)
- **Hiá»‡u suáº¥t cao** hÆ¡n SQLite
- **Concurrent connections** tá»‘t hÆ¡n
- **Backup vÃ  restore** dá»… dÃ ng
- **Chia sáº» database** giá»¯a cÃ¡c instances
- **HoÃ n toÃ n miá»…n phÃ­**
- **Auto-Fix Database** - Tá»± Ä‘á»™ng fix connection issues

## ğŸ‘¨â€ğŸ’» ThÃ´ng Tin TÃ¡c Giáº£

**ğŸŒŸ Nguyá»…n Ngá»c Thiá»‡n ğŸŒŸ**
- ğŸ“º **YouTube**: [Kalvin Thien Social](https://www.youtube.com/@kalvinthiensocial?sub_confirmation=1) - **ğŸ”¥ HÃƒY ÄÄ‚NG KÃ Äá»‚ á»¦NG Há»˜! ğŸ”¥**
- ğŸ“˜ **Facebook**: [@Ban.Thien.Handsome](https://www.facebook.com/Ban.Thien.Handsome/)
- ğŸ“± **Zalo/Phone**: 08.8888.4749
- ğŸ¬ **N8N Playlist**: [Danh sÃ¡ch video N8N](https://www.youtube.com/@kalvinthiensocial/playlists)
- ğŸš€ **NgÃ y cáº­p nháº­t**: 01/07/2025  
- ğŸ†• **PhiÃªn báº£n**: 4.0 Enhanced - Multi-Mode + Auto-Fix + Cloudflare Tunnel + Health Monitoring + Custom Ports

> ğŸ’¡ **Äá»«ng quÃªn nháº¥n SUBSCRIBE vÃ  ğŸ”” Ä‘á»ƒ khÃ´ng bá» lá»¡ nhá»¯ng video há»¯u Ã­ch má»›i nháº¥t!**
> 
> ğŸ¯ KÃªnh cá»§a mÃ¬nh chia sáº» kiáº¿n thá»©c vá»:
> - ğŸ¤– N8N Automation workflows
> - ğŸ³ Docker & DevOps
> - ğŸ’» Server management  
> - ğŸš€ Latest tech tutorials
> - ğŸ“± Social media automation

## ğŸ–¥ï¸ Há»— Trá»£ MÃ´i TrÆ°á»ng

âœ… **Ubuntu VPS/Server** (Recommend)  
âœ… **Ubuntu on Windows WSL**  
âœ… **Ubuntu Docker Environment**  
âœ… **Tá»± Ä‘á»™ng detect** vÃ  xá»­ lÃ½ mÃ´i trÆ°á»ng  
âœ… **Cloudflare Tunnel** - KhÃ´ng cáº§n public IP

## ğŸ“‹ YÃªu Cáº§u Há»‡ Thá»‘ng

### CÆ¡ Báº£n
- **OS**: Ubuntu 20.04+ (VPS hoáº·c WSL)
- **RAM**: Tá»‘i thiá»ƒu 2GB (khuyáº¿n nghá»‹ 4GB+ cho multi-domain)
- **Disk**: 20GB+ free space
- **Network**: Domains Ä‘Ã£ trá» vá» server (cho Domain Mode)
- **Permission**: Root access

### Enhanced Features (Version 4.0)
- **RAM**: Khuyáº¿n nghá»‹ 4GB+ (má»—i N8N instance ~512MB)
- **CPU**: 2+ cores cho hiá»‡u suáº¥t tá»‘t
- **Disk**: 30GB+ cho nhiá»u instances + backups
- **Google Account**: Cho Google Drive backup (optional)
- **Telegram Bot**: Cho remote management (optional)
- **Cloudflare Account**: Cho Cloudflare Tunnel (optional)

## ğŸš€ CÃ i Äáº·t Nhanh

### 1ï¸âƒ£ CÃ i Äáº·t Localhost Mode (KhÃ´ng cáº§n domain)

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -l
```

### 2ï¸âƒ£ CÃ i Äáº·t Cloudflare Tunnel Mode (KhÃ´ng cáº§n public IP)

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -f
```

### 3ï¸âƒ£ CÃ i Äáº·t Multi-Domain + PostgreSQL

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -m -p
```

### 4ï¸âƒ£ CÃ i Äáº·t Full Features vá»›i Auto-Fix

```bash
cd /tmp && curl -sSL https://raw.githubusercontent.com/KalvinThien/install-n8n-ffmpeg/main/auto_cai_dat_n8n.sh | tr -d '\r' > install_n8n.sh && chmod +x install_n8n.sh && sudo bash install_n8n.sh -m -p -g -t
```

### 5ï¸âƒ£ Options NÃ¢ng Cao Version 4.0

```bash
# Localhost mode vá»›i auto-fix
sudo ./auto_cai_dat_n8n.sh -l

# Cloudflare Tunnel mode
sudo ./auto_cai_dat_n8n.sh -f

# Multi-domain vá»›i PostgreSQL vÃ  auto-fix
sudo ./auto_cai_dat_n8n.sh -m -p

# Full features vá»›i táº¥t cáº£ tÃ­nh nÄƒng
sudo ./auto_cai_dat_n8n.sh -m -p -g -t

# Clean install vá»›i full features
sudo ./auto_cai_dat_n8n.sh -c -m -p -g -t

# Táº¯t auto-fix (khÃ´ng khuyáº¿n nghá»‹)
sudo ./auto_cai_dat_n8n.sh --no-auto-fix

# Xem trá»£ giÃºp
./auto_cai_dat_n8n.sh -h
```

## ğŸ”§ QuÃ¡ TrÃ¬nh CÃ i Äáº·t Version 4.0

Script sáº½ hÆ°á»›ng dáº«n báº¡n qua cÃ¡c bÆ°á»›c:

### Installation Modes (Má»›i)
1. **Localhost Mode** - KhÃ´ng cáº§n domain, truy cáº­p qua IP
2. **Domain Mode** - Cáº§n domain vÃ  DNS vá»›i SSL tá»± Ä‘á»™ng
3. **Cloudflare Tunnel Mode** - KhÃ´ng cáº§n public IP, hoÃ n toÃ n báº£o máº­t

### Setup Process (Enhanced)
1. **Chá»n Installation Mode** - Localhost/Domain/Cloudflare
2. **Setup Swap** tá»± Ä‘á»™ng (tÄƒng cÆ°á»ng cho multi-domain)
3. **Nháº­p domains** (single hoáº·c multiple)
4. **Custom Port Configuration** - Tá»± Ä‘á»™ng phÃ¢n bá»• ports
5. **Dashboard Security** - Basic Auth setup
6. **Cáº¥u hÃ¬nh PostgreSQL** (náº¿u Ä‘Æ°á»£c chá»n)
7. **Cáº¥u hÃ¬nh News API** (tÃ¹y chá»n)
8. **Cáº¥u hÃ¬nh Telegram** (tÃ¹y chá»n)
9. **Cáº¥u hÃ¬nh Google Drive** (náº¿u Ä‘Æ°á»£c chá»n)
10. **Cáº¥u hÃ¬nh Cloudflare Tunnel** (náº¿u Ä‘Æ°á»£c chá»n)
11. **Kiá»ƒm tra DNS** cho táº¥t cáº£ domains (Domain Mode)
12. **CÃ i Ä‘áº·t Docker** & dependencies
13. **Build & start** táº¥t cáº£ containers vá»›i auto-fix
14. **Setup SSL** cho táº¥t cáº£ domains
15. **Thiáº¿t láº­p services** (Dashboard, Telegram Bot, Health Monitor)
16. **Auto-Fix Integration** - Kiá»ƒm tra vÃ  fix lá»—i tá»± Ä‘á»™ng

## ğŸ”§ Auto-Fix System (Version 4.0)

### ğŸ› ï¸ Tá»± Äá»™ng Fix CÃ¡c Lá»—i Phá»• Biáº¿n
- **Permission Issues** - Tá»± Ä‘á»™ng fix quyá»n thÆ° má»¥c (1000:1000)
- **Docker Network Problems** - Tá»± Ä‘á»™ng recreate networks
- **Container Health Issues** - Tá»± Ä‘á»™ng restart containers khÃ´ng á»•n Ä‘á»‹nh
- **PostgreSQL Connection** - Tá»± Ä‘á»™ng fix database connection
- **SSL Certificate Problems** - Tá»± Ä‘á»™ng fix SSL issues
- **Port Conflicts** - Tá»± Ä‘á»™ng tÃ¬m port kháº£ dá»¥ng

### ğŸ”„ Auto-Recovery Features
- **Health Monitoring** - Kiá»ƒm tra sá»©c khá»e há»‡ thá»‘ng liÃªn tá»¥c
- **Retry Mechanism** - Tá»± Ä‘á»™ng thá»­ láº¡i khi tháº¥t báº¡i
- **Graceful Degradation** - Há»‡ thá»‘ng váº«n hoáº¡t Ä‘á»™ng khi cÃ³ lá»—i
- **Telegram Alerts** - ThÃ´ng bÃ¡o lá»—i vÃ  fix status

### ğŸ“Š Auto-Fix Commands
```bash
# Tá»± Ä‘á»™ng fix táº¥t cáº£ lá»—i
/home/n8n/auto-fix.sh

# Fix permissions
/home/n8n/auto-fix.sh permissions

# Fix Docker networks
/home/n8n/auto-fix.sh networks

# Fix PostgreSQL
/home/n8n/auto-fix.sh database

# Fix SSL certificates
/home/n8n/auto-fix.sh ssl
```

## â˜ï¸ Cloudflare Tunnel Mode (Version 4.0)

### ğŸŒ TÃ­nh NÄƒng Cloudflare Tunnel
- **No Public IP Required** - Hoáº¡t Ä‘á»™ng ngay cáº£ khi khÃ´ng cÃ³ public IP
- **Automatic SSL** - SSL certificates tá»± Ä‘á»™ng tá»« Cloudflare
- **DDoS Protection** - Báº£o vá»‡ khá»i DDoS attacks
- **Zero Trust Security** - Báº£o máº­t cao cáº¥p
- **Easy Setup** - Chá»‰ cáº§n tunnel token tá»« Cloudflare dashboard

### ğŸ”§ Thiáº¿t Láº­p Cloudflare Tunnel
1. Truy cáº­p [Cloudflare Zero Trust](https://one.dash.cloudflare.com/)
2. VÃ o Zero Trust â†’ Access â†’ Tunnels
3. Create a tunnel â†’ Cloudflared
4. Äáº·t tÃªn tunnel (vd: n8n-tunnel)
5. Copy tunnel token
6. Nháº­p token vÃ o script

### ğŸ“ Cáº¥u TrÃºc Cloudflare
```
/home/n8n/cloudflare/
â”œâ”€â”€ config.yml              # Tunnel configuration
â”œâ”€â”€ credentials.json        # Cloudflare credentials
â””â”€â”€ tunnel.log             # Tunnel logs
```

## ğŸ”Œ Custom Port Configuration (Version 4.0)

### ğŸŒ Dynamic Port Assignment
- **Auto Port Detection** - Tá»± Ä‘á»™ng tÃ¬m port kháº£ dá»¥ng
- **Port Conflict Resolution** - TrÃ¡nh xung Ä‘á»™t port
- **Custom Base Ports** - CÃ³ thá»ƒ thay Ä‘á»•i base port máº·c Ä‘á»‹nh
- **Multi-Instance Ports** - Má»—i N8N instance cÃ³ port riÃªng

### ğŸ“Š Port Management
```bash
# Default ports
N8N Base Port: 5678
API Base Port: 8000
Dashboard Port: 8080

# Multi-domain ports
Instance 1: 5678
Instance 2: 5800
Instance 3: 5801
...
```

## ğŸ“Š Enhanced Health Monitoring (Version 4.0)

### ğŸ¥ Health Check System
- **Real-time Monitoring** - Kiá»ƒm tra sá»©c khá»e há»‡ thá»‘ng liÃªn tá»¥c
- **Auto-Recovery** - Tá»± Ä‘á»™ng khÃ´i phá»¥c khi cÃ³ lá»—i
- **Performance Metrics** - Theo dÃµi hiá»‡u suáº¥t realtime
- **Telegram Alerts** - ThÃ´ng bÃ¡o lá»—i qua Telegram

### ğŸ”„ Health Check Features
```bash
# Health check endpoints
N8N: /healthz
News API: /health
PostgreSQL: pg_isready
Caddy: Built-in health checks

# Health check interval: 30s
# Retry attempts: 3
# Auto-recovery: Enabled
```

## ğŸ¤– Telegram Bot Management (Enhanced Version 4.0)

### ğŸ”§ Lá»‡nh Bot CÆ¡ Báº£n
```
/start          - Khá»Ÿi Ä‘á»™ng bot
/status         - Tráº¡ng thÃ¡i táº¥t cáº£ instances
/health         - Health check chi tiáº¿t
/performance    - Performance metrics
/help           - Danh sÃ¡ch lá»‡nh
```

### ğŸ› ï¸ Quáº£n LÃ½ Services (Enhanced)
```
/restart all              - Restart táº¥t cáº£ services
/restart n8n              - Restart N8N container
/restart caddy            - Restart Caddy proxy
/restart postgres         - Restart PostgreSQL
/auto-fix                 - Cháº¡y auto-fix system
/auto-fix permissions     - Fix permissions
/auto-fix networks        - Fix Docker networks
/auto-fix database        - Fix PostgreSQL
/auto-fix ssl             - Fix SSL certificates
```

### ğŸ“‹ Logs & Monitoring (Enhanced)
```
/logs all                 - Logs táº¥t cáº£ services
/logs n8n 50              - 50 dÃ²ng logs cuá»‘i cá»§a N8N
/backup                   - Cháº¡y backup manual
/troubleshoot             - Cháº¡y diagnostic
/health-monitor           - Health monitor status
```

### ğŸ“Š VÃ­ Dá»¥ Output (Enhanced)
```
ğŸš€ N8N System Status v4.0

ğŸ“Š System Info:
â€¢ Uptime: up 2 days, 14 hours, 32 minutes
â€¢ Memory: 2.1G/4.0G
â€¢ Disk Usage: 45%
â€¢ Auto-Fix: âœ… Enabled
â€¢ Health Monitor: âœ… Active

ğŸŒ Installation Mode: Cloudflare Tunnel
ğŸŒ Domains (3):
â€¢ Instance 1: n8n1.example.com (Port: 5678)
â€¢ Instance 2: n8n2.example.com (Port: 5800)
â€¢ Instance 3: n8n3.example.com (Port: 5801)

ğŸ³ Containers (6):
âœ… n8n-container-1: running (healthy)
âœ… n8n-container-2: running (healthy)
âœ… caddy-proxy: running (healthy)
âœ… postgres-n8n: running (healthy)
âœ… cloudflared: running (healthy)
âœ… news-api-container: running (healthy)

ğŸ”§ Auto-Fix Status:
â€¢ Last Check: 2 minutes ago
â€¢ Issues Fixed: 0
â€¢ System Health: âœ… Excellent
```

## â˜ï¸ Google Drive Backup System (Enhanced Version 4.0)

### ğŸ”§ Thiáº¿t Láº­p Google Drive API
1. Truy cáº­p [Google Cloud Console](https://console.developers.google.com/)
2. Táº¡o project má»›i hoáº·c chá»n project cÃ³ sáºµn
3. Enable Google Drive API
4. Táº¡o Service Account credentials
5. Download JSON credentials file
6. Share Google Drive folder vá»›i service account

### ğŸ“ Cáº¥u TrÃºc Backup (Enhanced)
```
N8N-Backups/
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 06-June/
â”‚   â”‚   â”œâ”€â”€ domain1.com/
â”‚   â”‚   â”‚   â”œâ”€â”€ n8n_backup_20250628_140000.zip
â”‚   â”‚   â”‚   â””â”€â”€ n8n_backup_20250627_020000.zip
â”‚   â”‚   â”œâ”€â”€ domain2.com/
â”‚   â”‚   â””â”€â”€ All-Domains/
â”‚   â””â”€â”€ 07-July/
â””â”€â”€ 2024/
```

### ğŸ”„ Auto Backup Features (Enhanced)
- **Daily upload** lÃªn Google Drive
- **Organized by** year/month/domain
- **Automatic cleanup** old backups
- **Telegram notifications** vá»›i status
- **Fallback local** náº¿u upload tháº¥t báº¡i
- **Auto-Fix Integration** - Tá»± Ä‘á»™ng fix backup issues

## ğŸ“Š Web Dashboard (Enhanced Version 4.0)

### ğŸŒ Truy Cáº­p Dashboard
```
http://YOUR_SERVER_IP:8080
```

### ğŸ“ˆ TÃ­nh NÄƒng Dashboard (Enhanced)
- **Real-time monitoring** táº¥t cáº£ instances
- **System metrics** (CPU, Memory, Disk, Network)
- **Container status** vá»›i health checks
- **SSL certificate** monitoring
- **Backup status** vÃ  history
- **Quick actions** (restart, backup, logs)
- **Mobile responsive** design
- **Auto-refresh** every 30 seconds
- **Auto-Fix Dashboard** - Giao diá»‡n quáº£n lÃ½ auto-fix
- **Health Monitor Status** - Tráº¡ng thÃ¡i health monitoring

### ğŸ”§ Quick Actions (Enhanced)
- ğŸ”„ **Refresh Data** - Cáº­p nháº­t realtime
- ğŸ”„ **Restart All** - Restart táº¥t cáº£ services
- ğŸ’¾ **Manual Backup** - Cháº¡y backup manual
- ğŸ“‹ **View Logs** - Xem logs trong tab má»›i
- â¬†ï¸ **Update System** - Update há»‡ thá»‘ng
- ğŸ”§ **Troubleshoot** - Cháº¡y diagnostic script
- ğŸ› ï¸ **Auto-Fix** - Cháº¡y auto-fix system
- ğŸ¥ **Health Check** - Cháº¡y health check manual

## ğŸ“° News Content API (Enhanced Version 4.0)

### ğŸ”‘ Authentication
Táº¥t cáº£ API calls yÃªu cáº§u Bearer Token:
```bash
Authorization: Bearer YOUR_TOKEN_HERE
```

### ğŸ“– API Documentation
Sau khi cÃ i Ä‘áº·t, truy cáº­p:
- **Homepage**: `https://api.yourdomain.com/`
- **Swagger UI**: `https://api.yourdomain.com/docs`
- **ReDoc**: `https://api.yourdomain.com/redoc`

### ğŸ’» VÃ­ Dá»¥ cURL
```bash
# Láº¥y ná»™i dung bÃ i viáº¿t
curl -X POST "https://api.yourdomain.com/extract-article" \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -d '{
       "url": "https://dantri.com.vn/the-gioi.htm",
       "language": "vi",
       "extract_images": true,
       "summarize": true
     }'
```

## ğŸ’¾ Enhanced Backup & Restore System (Version 4.0)

### ğŸ”„ Multi-Domain Backup Features (Enhanced)
- **ZIP compression** tá»‘i Æ°u dung lÆ°á»£ng
- **Multi-domain backup** táº¥t cáº£ instances cÃ¹ng lÃºc
- **PostgreSQL databases** backup riÃªng tá»«ng instance
- **SSL certificates** backup vÃ  restore
- **Configuration files** backup
- **Metadata** chi tiáº¿t cho má»—i backup
- **Auto-Fix Integration** - Tá»± Ä‘á»™ng fix backup issues

### ğŸ“± Telegram Integration (Enhanced)
- **Detailed reports** vá» táº¥t cáº£ instances
- **File upload** náº¿u <50MB
- **Status notifications** success/failure
- **Fallback**: Giá»¯ backup local náº¿u Telegram tháº¥t báº¡i
- **Auto-Fix Notifications** - ThÃ´ng bÃ¡o auto-fix status

### â˜ï¸ Google Drive Integration (Enhanced)
- **Auto-upload** sau má»—i backup
- **Organized folders** theo domain vÃ  ngÃ y
- **Easy restore** tá»« Google Drive
- **Cross-platform** access
- **Auto-Fix Integration** - Tá»± Ä‘á»™ng fix upload issues

### ğŸ”„ Restore System (Enhanced)
```bash
# Restore tá»« backup file
/home/n8n/restore-from-backup.sh /path/to/backup.zip

# Restore domain cá»¥ thá»ƒ
/home/n8n/restore-from-backup.sh /path/to/backup.zip domain.com

# Restore sáº½:
# 1. Stop táº¥t cáº£ services
# 2. Restore configuration files
# 3. Restore SSL certificates
# 4. Restore PostgreSQL databases
# 5. Restore N8N instances data
# 6. Import workflows vÃ  credentials
# 7. Start táº¥t cáº£ services
# 8. Run auto-fix Ä‘á»ƒ Ä‘áº£m báº£o stability
```

## ğŸ”’ Enhanced Security Features (Version 4.0)

### ğŸ” Basic Authentication (Enhanced)
- **Auto-generated** username/password cho N8N
- **Secure storage** credentials
- **Easy rotation** passwords
- **Dashboard Security** - Basic Auth cho dashboard

### ğŸ›¡ï¸ IP Filtering (Enhanced)
- **Whitelist** allowed IP addresses
- **CIDR block** support
- **Easy configuration** via file
- **Cloudflare Integration** - IP filtering vá»›i Cloudflare

### ğŸš« Fail2ban Protection (Enhanced)
- **Auto-ban** malicious IPs
- **Custom rules** cho N8N
- **Configurable** ban times
- **Cloudflare Integration** - Fail2ban vá»›i Cloudflare

### ğŸ”’ SSL Security Headers (Enhanced)
- **HSTS** enforcement
- **XSS protection**
- **Content Security Policy**
- **Frame protection**
- **Cloudflare Zero Trust** integration

## ğŸ› ï¸ Quáº£n LÃ½ Há»‡ Thá»‘ng (Version 4.0)

### ğŸ”§ Lá»‡nh CÆ¡ Báº£n (Enhanced)
```bash
# Xem tráº¡ng thÃ¡i táº¥t cáº£ containers
cd /home/n8n && docker-compose ps

# Xem logs realtime táº¥t cáº£ services
cd /home/n8n && docker-compose logs -f

# Restart toÃ n bá»™ há»‡ thá»‘ng
cd /home/n8n && docker-compose restart

# Web Dashboard
http://YOUR_SERVER_IP:8080

# Auto-Fix System
/home/n8n/auto-fix.sh

# Health Monitor
systemctl status n8n-health-monitor

# Troubleshoot script
/home/n8n/troubleshoot.sh
```

### ğŸ“Š Management Tools (Enhanced)
```bash
# Enhanced backup
/home/n8n/backup-workflows-enhanced.sh

# Restore system
/home/n8n/restore-from-backup.sh

# Manual backup test
/home/n8n/backup-manual.sh

# Auto-Fix System
/home/n8n/auto-fix.sh

# Health Monitor
/home/n8n/health_checks/health_monitor.sh
```

## ğŸ“‚ Cáº¥u TrÃºc ThÆ° Má»¥c Enhanced (Version 4.0)

```
/home/n8n/
â”œâ”€â”€ docker-compose.yml              # Main config vá»›i multi-domain
â”œâ”€â”€ Dockerfile                      # N8N custom image
â”œâ”€â”€ Caddyfile                       # Reverse proxy cho táº¥t cáº£ domains
â”œâ”€â”€ init-multi-db.sh                # PostgreSQL init script
â”œâ”€â”€ backup-workflows-enhanced.sh    # Enhanced backup script
â”œâ”€â”€ restore-from-backup.sh          # Enhanced restore script
â”œâ”€â”€ troubleshoot.sh                 # Multi-domain diagnostic script
â”œâ”€â”€ auto-fix.sh                     # Auto-Fix system script
â”œâ”€â”€ telegram_config.txt             # Telegram settings
â”œâ”€â”€ dashboard/                      # Web Dashboard
â”‚   â”œâ”€â”€ index.html                 # Dashboard UI
â”‚   â”œâ”€â”€ api_server.py              # Dashboard API server
â”‚   â””â”€â”€ assets/                    # Static assets
â”œâ”€â”€ telegram_bot/                   # Telegram Bot Management
â”‚   â”œâ”€â”€ bot.py                     # Main bot script
â”‚   â””â”€â”€ start_bot.sh               # Bot startup script
â”œâ”€â”€ google_drive/                   # Google Drive Integration
â”‚   â”œâ”€â”€ gdrive_backup.py           # Google Drive backup script
â”‚   â”œâ”€â”€ credentials.json           # Service account credentials
â”‚   â””â”€â”€ cleanup_old_backups.py     # Cleanup script
â”œâ”€â”€ cloudflare/                     # Cloudflare Tunnel
â”‚   â”œâ”€â”€ config.yml                 # Tunnel configuration
â”‚   â”œâ”€â”€ credentials.json           # Cloudflare credentials
â”‚   â””â”€â”€ tunnel.log                 # Tunnel logs
â”œâ”€â”€ health_checks/                  # Health Monitoring
â”‚   â”œâ”€â”€ health_monitor.sh          # Health monitor script
â”‚   â”œâ”€â”€ health_check.sh            # Health check script
â”‚   â””â”€â”€ auto_recovery.sh           # Auto recovery script
â”œâ”€â”€ security/                       # Security configurations
â”‚   â”œâ”€â”€ setup_security.sh          # Security setup script
â”‚   â”œâ”€â”€ auth_credentials.txt        # Basic auth credentials
â”‚   â”œâ”€â”€ allowed_ips.txt            # IP whitelist
â”‚   â””â”€â”€ ssl_headers.conf           # SSL security headers
â”œâ”€â”€ management/                     # Management tools
â”‚   â”œâ”€â”€ dashboard.sh               # CLI dashboard
â”‚   â”œâ”€â”€ menu.sh                    # Management menu
â”‚   â””â”€â”€ export-migration.sh        # Migration tools
â”œâ”€â”€ files/                          # N8N data
â”‚   â”œâ”€â”€ backup_full/               # Enhanced backup storage
â”‚   â”œâ”€â”€ n8n_instance_1/           # Instance 1 data
â”‚   â”œâ”€â”€ n8n_instance_2/           # Instance 2 data
â”‚   â””â”€â”€ n8n_instance_n/           # Instance N data
â”œâ”€â”€ postgres_data/                  # PostgreSQL data (if enabled)
â”œâ”€â”€ logs/                          # System logs
â””â”€â”€ news_api/                       # News API (shared)
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ main.py
```

## âš¡ Performance Tips (Version 4.0)

### ğŸš€ Multi-Mode Optimization
1. **Localhost Mode**: Tá»‘i Æ°u cho development vÃ  testing
2. **Domain Mode**: Tá»‘i Æ°u cho production vá»›i SSL
3. **Cloudflare Mode**: Tá»‘i Æ°u cho báº£o máº­t cao vÃ  khÃ´ng cÃ³ public IP
4. **Memory**: Script tá»± Ä‘á»™ng tÄƒng swap cho multi-domain
5. **CPU**: Má»—i N8N instance sá»­ dá»¥ng optimized workers
6. **Database**: PostgreSQL shared connection pooling
7. **Disk**: Auto cleanup old backups vÃ  logs
8. **Network**: Caddy auto-compression cho táº¥t cáº£ domains

### ğŸ“Š Monitoring Multi-Mode (Enhanced)
```bash
# Resource usage táº¥t cáº£ containers
docker stats --no-stream

# Real-time dashboard
http://YOUR_SERVER_IP:8080

# Telegram monitoring
/status trong Telegram Bot

# Performance metrics
/performance trong Telegram Bot

# Health monitor
systemctl status n8n-health-monitor

# Auto-fix status
/home/n8n/auto-fix.sh status
```

## ğŸ› Troubleshooting (Version 4.0)

### âŒ Lá»—i ThÆ°á»ng Gáº·p Enhanced

**1. Auto-Fix System khÃ´ng hoáº¡t Ä‘á»™ng**
```bash
# Kiá»ƒm tra auto-fix service
systemctl status n8n-auto-fix

# Cháº¡y auto-fix manual
/home/n8n/auto-fix.sh

# Xem auto-fix logs
tail -f /var/log/n8n-auto-fix.log
```

**2. Cloudflare Tunnel khÃ´ng káº¿t ná»‘i**
```bash
# Kiá»ƒm tra tunnel status
systemctl status cloudflared

# Xem tunnel logs
journalctl -u cloudflared -f

# Test tunnel connection
cloudflared tunnel info
```

**3. Health Monitor khÃ´ng hoáº¡t Ä‘á»™ng**
```bash
# Kiá»ƒm tra health monitor
systemctl status n8n-health-monitor

# Xem health monitor logs
journalctl -u n8n-health-monitor -f

# Restart health monitor
systemctl restart n8n-health-monitor
```

**4. Custom Ports khÃ´ng hoáº¡t Ä‘á»™ng**
```bash
# Kiá»ƒm tra port usage
netstat -tulpn | grep :5678

# Check port conflicts
/home/n8n/auto-fix.sh ports

# Fix port issues
/home/n8n/auto-fix.sh networks
```

**5. Multi-Mode issues**
```bash
# Kiá»ƒm tra installation mode
cat /home/n8n/installation_mode.txt

# Switch mode
/home/n8n/switch-mode.sh localhost
/home/n8n/switch-mode.sh domain
/home/n8n/switch-mode.sh cloudflare
```

## ğŸŒŸ Features Roadmap (Version 4.0)

- [x] **Multi-Mode** support (Localhost/Domain/Cloudflare) âœ…
- [x] **Auto-Fix Integration** system âœ…
- [x] **Health Monitoring** & Auto-Recovery âœ…
- [x] **Custom Port Configuration** âœ…
- [x] **Cloudflare Tunnel** support âœ…
- [x] **Multi-domain** support âœ…
- [x] **PostgreSQL** external database âœ…
- [x] **Telegram Bot** management âœ…
- [x] **Google Drive** backup âœ…
- [x] **Web Dashboard** âœ…
- [x] **Enhanced Security** âœ…
- [ ] **Load balancing** between instances
- [ ] **Kubernetes** deployment
- [ ] **Advanced monitoring** dashboard with metrics
- [ ] **Auto-scaling** based on load
- [ ] **Plugin** marketplace integration
- [ ] **Cross-instance** workflow sharing
- [ ] **Multi-cloud** deployment support

## ğŸ¤ Contributing

1. Fork repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Create Pull Request

## ğŸ“„ License

MIT License - Xem file [LICENSE](LICENSE)

## ğŸ’¬ Support

- **Issues**: [GitHub Issues](https://github.com/KalvinThien/install-n8n-ffmpeg/issues)
- **YouTube**: [Kalvin Thien Social](https://www.youtube.com/@kalvinthiensocial)
- **Facebook**: [Ban Thien Handsome](https://www.facebook.com/Ban.Thien.Handsome/)
- **Zalo**: 08.8888.4749

## â­ Star History

Náº¿u script nÃ y há»¯u Ã­ch, hÃ£y cho má»™t â­ star Ä‘á»ƒ á»§ng há»™!

[![Star History Chart](https://api.star-history.com/svg?repos=KalvinThien/install-n8n-ffmpeg&type=Date)](https://star-history.com/#KalvinThien/install-n8n-ffmpeg&Date)

---

**ğŸš€ Made with â¤ï¸ by Nguyá»…n Ngá»c Thiá»‡n - 01/07/2025**  
**ğŸ†• Enhanced Version 4.0 - Multi-Mode + Auto-Fix + Cloudflare Tunnel + Health Monitoring + Custom Ports**

## ğŸ”§ Troubleshooting & Fix Issues (Version 4.0)

### ğŸš¨ Khi gáº·p lá»—i HTTP 502 hoáº·c N8N khÃ´ng hoáº¡t Ä‘á»™ng

Náº¿u gáº·p cÃ¡c váº¥n Ä‘á» sau:
- âŒ HTTP ERROR 502 khi truy cáº­p domains
- âŒ N8N containers liÃªn tá»¥c restart
- âŒ Permission denied errors
- âŒ PostgreSQL connection issues
- âŒ SSL certificate problems
- âŒ Cloudflare Tunnel connection issues
- âŒ Health monitor not working

### ğŸ› ï¸ Auto-Fix System ToÃ n Diá»‡n (Version 4.0)

**Script `auto-fix.sh` sáº½ tá»± Ä‘á»™ng fix táº¥t cáº£ váº¥n Ä‘á»:**

```bash
# 1. Auto-Fix System Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p sáºµn
# Cháº¡y auto-fix toÃ n diá»‡n
sudo /home/n8n/auto-fix.sh

# 2. Fix tá»«ng pháº§n cá»¥ thá»ƒ
sudo /home/n8n/auto-fix.sh permissions    # Fix permissions
sudo /home/n8n/auto-fix.sh networks       # Fix Docker networks
sudo /home/n8n/auto-fix.sh database       # Fix PostgreSQL
sudo /home/n8n/auto-fix.sh ssl            # Fix SSL certificates
sudo /home/n8n/auto-fix.sh ports          # Fix port conflicts
sudo /home/n8n/auto-fix.sh health         # Fix health monitor
```

### ğŸ” Auto-Fix System sáº½ fix cÃ¡c váº¥n Ä‘á»:

1. **âœ… Fix Permission Issues (1000:1000)**
   - Chá»‰nh sá»­a quyá»n thÆ° má»¥c N8N
   - Fix user/group ownership
   - Táº¡o missing directories

2. **ğŸŒ Fix Docker Network & Service Names**
   - Recreate Docker networks
   - Fix container name resolution
   - Clean up old networks

3. **ğŸ˜ Fix PostgreSQL Database Issues**
   - Táº¡o láº¡i users vÃ  databases
   - Fix connection issues
   - Test database connectivity

4. **ğŸ”’ Fix SSL Certificate Problems**
   - Update Caddyfile vá»›i container names Ä‘Ãºng
   - Add health checks
   - Fix reverse proxy configuration

5. **â˜ï¸ Fix Cloudflare Tunnel Issues**
   - Recreate tunnel configuration
   - Fix tunnel credentials
   - Restart tunnel service

6. **ğŸ”Œ Fix Custom Port Issues**
   - Resolve port conflicts
   - Reassign available ports
   - Update configuration files

7. **ğŸ¥ Fix Health Monitor Issues**
   - Restart health monitor service
   - Fix health check scripts
   - Update monitoring configuration

8. **ğŸš€ Restart Services in Correct Order**
   - PostgreSQL â†’ N8N â†’ API â†’ Caddy â†’ Cloudflare
   - Verify service health
   - Clean up old containers

9. **ğŸ“Š Health Check All Components**
   - Test container connectivity
   - Verify domain accessibility
   - Check SSL certificates
   - Test Cloudflare tunnel

### ğŸ“‹ Log vÃ  Monitoring (Enhanced)

Auto-Fix System sáº½ táº¡o log file chi tiáº¿t táº¡i `/var/log/n8n-auto-fix.log`

```bash
# Xem log auto-fix
tail -f /var/log/n8n-auto-fix.log

# Monitor containers sau khi fix
cd /home/n8n && docker-compose logs -f

# Check status
cd /home/n8n && docker-compose ps

# Health monitor status
systemctl status n8n-health-monitor
```

### ğŸ¯ Káº¿t quáº£ mong Ä‘á»£i sau khi auto-fix:

âœ… Táº¥t cáº£ domains hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng  
âœ… SSL certificates Ä‘Æ°á»£c cáº¥p tá»± Ä‘á»™ng  
âœ… N8N instances khá»Ÿi Ä‘á»™ng á»•n Ä‘á»‹nh  
âœ… PostgreSQL káº¿t ná»‘i thÃ nh cÃ´ng  
âœ… Cloudflare Tunnel hoáº¡t Ä‘á»™ng  
âœ… Health Monitor active  
âœ… No more HTTP 502 errors  
âœ… Auto-Fix System ready  

**â° LÆ°u Ã½**: Cáº§n Ä‘á»£i 2-3 phÃºt sau khi fix Ä‘á»ƒ SSL certificates Ä‘Æ°á»£c cáº¥p hoÃ n toÃ n vÃ  Cloudflare Tunnel káº¿t ná»‘i.

### ğŸ”„ Auto-Fix Integration vá»›i Telegram Bot

```bash
# Lá»‡nh Telegram Bot cho auto-fix
/auto-fix                 # Cháº¡y auto-fix toÃ n diá»‡n
/auto-fix permissions     # Fix permissions
/auto-fix networks        # Fix Docker networks
/auto-fix database        # Fix PostgreSQL
/auto-fix ssl             # Fix SSL certificates
/auto-fix health          # Fix health monitor
/auto-fix status          # Xem auto-fix status
```
